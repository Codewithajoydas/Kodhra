<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= notebook.notebookName %> | Kodhra - Code Snippet Manager
    </title>
    <link rel="stylesheet" href="/style/css/partials/Header.css">
    <link rel="stylesheet" href="/style/css/ad_search.css">
    <link rel="stylesheet" href="/style/css/Notification.css">
    <link rel="stylesheet" href="/style/css/index.css">
    <link rel="stylesheet" href="/style/css/card.css">
    <link rel="stylesheet" href="/style/css/loader.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/assets/logo.webp" type="image/png" />
    <script src="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@2.3.5/dist/toaster.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@2.3.5/dist/toaster.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/scripts/getSettings.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <style>
        textarea {
            background: none !important;
        }

        .EasyMDEContainer .CodeMirror {
            min-height: calc(100vh - 200px);
            border-radius: 0px;
        }

        .EasyMDEContainer .CodeMirror-scroll {
            min-height: calc(100vh - 200px);
        }

        #editor,
        .EasyMDEContainer {
            height: auto !important;
        }

        .EasyMDEContainer .CodeMirror {
            background: var(--bg-color) !important;
            color: var(--color);
            caret-color: var(--color) !important;
            accent-color: var(--color) !important;
        }

        .EasyMDEContainer .CodeMirror-scroll {
            background: var(--bg-color) !important;
            color: var(--color);
            caret-color: var(--color) !important;
            accent-color: var(--color) !important;
        }

        .EasyMDEContainer .editor-toolbar {
            background: var(--accent) !important;
        }

        .cursor {
            background: none !important;
            display: none !important;
        }

        button {
            background: none !important;
            color: var(--color) !important;
        }
    </style>
    <style>
        pre {
            background-color: var(--accent);
            padding: 2px 4px;
            border-radius: 4px;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 1rem 0;
        }

        p {
            margin: .2rem 0;
        }

        ul {
            padding-left: 1rem;
        }

        li {
            margin-left: 2rem;
            margin-block: .5rem;
            padding-left: .2rem;
        }
    </style>

</head>

<body data-theme="light">
    <%- include('partials/loader') %>

        <div class="content">
            <%- include('partials/header') %>
                <div class="container">
                    <%- include('partials/sidebar', {navigation: 'notebook' })%>
                        <main style="height: calc(100vh - 70px); overflow-y: auto; ">
                            <section style="z-index: 99999; overflow: visible; position: relative;">
                                <div class="editor_header"
                                    style="display: flex; justify-content: space-between;align-items: center; margin-block: 10px; gap: 10px; position: sticky; top: -10px; z-index: 999; backdrop-filter: blur(10px); background: rgba(0, 0, 0, .003); padding-block: 5px;">
                                    <label for="notebookTitle"
                                        style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                                        <span
                                            style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="lucide lucide-file-type-corner-icon lucide-file-type-corner">
                                                <path
                                                    d="M12 22h6a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v6" />
                                                <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                                                <path d="M3 16v-1.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5V16" />
                                                <path d="M6 22h2" />
                                                <path d="M7 14v8" />
                                            </svg>
                                            Notebook Title
                                        </span>
                                        <input type="text" name="notebookTitle" id="notebookTitle"
                                            value="<%= notebook.notebookName%>"
                                            style="outline: none; border: none; border-bottom: 1px solid var(--accent);padding: 5px;">
                                    </label>
                                    <button id="saveBtn"
                                        style="margin-inline: 10px; background: var(--color) !important; color: var(--bg-color) !important;">Save
                                        NoteBook</button>
                                </div>

                                <textarea id="asd"><%= notebook.content %></textarea>
                            </section>
                        </main>
                </div>
        </div>

        <script src="/scripts/ad_search.js"></script>
        <script src="/scripts/Fab.js"></script>
        <script src="/scripts/Notification.js"></script>
        <script src="/scripts/searchFunction.js"></script>
        <script src="\scripts\isonline.js"></script>
        <script src="\scripts\collapse.js"></script>
        <script src="/scripts/Tooltips.js"></script>

        <script>
            const easyMDE = new EasyMDE({
                element: document.getElementById("asd"),
                toolbar: [
                    "bold", "italic", "heading", "|",
                    "quote", "unordered-list", "ordered-list", "|",
                    "link", "image", "table", "|",
                    "preview",
                ]
            });

            document.getElementById('saveBtn').addEventListener('click', async () => {
                const content = easyMDE.value();
                const notebookTitle = document.getElementById('notebookTitle').value;
                if (!notebookTitle) {
                    return new Toastmaster({
                        title: "Error",
                        message: "Please enter a notebook title",
                        type: "error",
                        delay: 3000,
                    }).showNotification();
                }
                const res = await fetch('/notebook/<%= notebook._id%>', {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        notebookName: notebookTitle,
                        content
                    })
                })
                const data = await res.json();
                console.log(data);
                if (res.ok) {
                    new Toastmaster({
                        title: "Success",
                        message: "Notebook saved successfully",
                        type: "success",
                        delay: 3000,
                    }).showNotification();
                    document.querySelector(".toast").addEventListener("transitionend", () => {
                        window.location.href = "/notebook";
                    })
                } else {
                    new Toastmaster({
                        title: "Error",
                        message: data.message,
                        type: "error",
                        delay: 3000,
                    }).showNotification();
                }
            });
        </script>
</body>

</html>