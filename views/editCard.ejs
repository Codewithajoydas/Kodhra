<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Card | Kodhra - Code Snippet Manager</title>
    <link rel="stylesheet" href="/style/css/partials/Header.css">
    <link rel="stylesheet" href="/style/css/ad_search.css">
    <link rel="stylesheet" href="/style/css/Notification.css">
    <link rel="stylesheet" href="/style/css/index.css">
    <link rel="stylesheet" href="/style/css/card.css">
    <link rel="stylesheet" href="/style/css/folder.css">
    <link rel="stylesheet" href="/style/css/createSnippet.css">
    <link rel="stylesheet" href="/style/css/loader.css">
    <script src="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@3.0.0/dist/toaster.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@3.0.0/dist/toaster.min.css">

    <script src="/socket.io/socket.io.js"></script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/assets/logo.webp" type="image/png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/theme/eclipse.min.css">

    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js">
    </script>
    <!-- Core language dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>

    <!-- HTML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

    <!-- C-family -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>

    <!-- Other languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/ruby/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/go/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/rust/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/swift/swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/shell/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/powershell/powershell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/perl/perl.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/r/r.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/haskell/haskell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/erlang/erlang.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/dart/dart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clojure/clojure.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/matlab/matlab.min.js"></script>
    <!-- Core autocomplete engine -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/css-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/sql-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/anyword-hint.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/eclipse.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/ayu-dark.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/mode/simple.min.js">
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/solarized.min.css" />

    <style>
        .CodeMirror {
            min-height: 100px;
            width: 100%;
        }
    </style>
</head>

<body data-theme="light">
    <%- include("partials/loader.ejs") %>
        <div class="content">
            <%- include("partials/header")%>
                <div class="container">
                    <%- include("partials/sidebar", {navigation: 'card-create' })%>
                        <main style="width: 100%;height: calc(100vh - 70px); position: relative;">

                            <div class="snippet-editor">

                                <header class="snippet-header">
                                    <label for="title1">
                                        <span
                                            style="display: flex; justify-content: start; align-items: center; gap: 5px; font-size: 15px !important;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="lucide lucide-file-code-icon lucide-file-code">
                                                <path
                                                    d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                                                <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                                                <path d="M10 12.5 8 15l2 2.5" />
                                                <path d="m14 12.5 2 2.5-2 2.5" />
                                            </svg>
                                            Snippet Title
                                        </span>
                                        <input type="text" id="title1" placeholder="Snippet title…"
                                            class="snippet-title" style="display: inline-block !important;"
                                            value="<%= card.title %>" />
                                    </label>
                                    <div class="snippet-actions">
                                        <button onclick="submitData()"
                                            style="background: var(--accent2);color: var(--color);width: 150px; border: none;">
                                            Save Snippet
                                        </button>
                                        <button onclick="window.location.reload()"
                                            style="--accent2:pink;--color:red; border: none !important;">Cancel</button>
                                    </div>
                                </header>

                                <!-- 2. CODE EDITOR -->
                                <section class="editor-section">
                                    <div class="editor-toolbar">
                                        <span class="editor-label"
                                            style="font-weight: bold; display: flex; justify-content: start;align-items: center;gap: 5px;font-size: 15px;"><svg
                                                xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="lucide lucide-code-icon lucide-code">
                                                <path d="m16 18 6-6-6-6" />
                                                <path d="m8 6-6 6 6 6" />
                                            </svg> Code Snippet </span>
                                        <% const lang=(settings.defaultLanguage || '' ).trim(); %>
                                            <div class="editor-tools">
                                                <!-- <div class="add-readme" role="button">
                          <span style="font-size: small; color: blue;">add readme.md</span>
                        </div> -->
                                                <select name="language" id="category" class="klas">
                                                    <option value="JavaScript" <%=lang==='JavaScript' ? 'selected' : ''
                                                        %>>JavaScript</option>
                                                    <option value="CSS" <%=lang==='CSS' ? 'selected' : '' %>>CSS
                                                    </option>
                                                    <option value="HTML" <%=lang==='HTML' ? 'selected' : '' %>>HTML
                                                    </option>
                                                    <option value="C" <%=lang==='C' ? 'selected' : '' %>>C</option>
                                                    <option value="C++" <%=lang==='C++' ? 'selected' : '' %>>C++
                                                    </option>
                                                    <option value="C#" <%=lang==='C#' ? 'selected' : '' %>>C#</option>
                                                    <option value="Java" <%=lang==='Java' ? 'selected' : '' %>>Java
                                                    </option>
                                                    <option value="TypeScript" <%=lang==='TypeScript' ? 'selected' : ''
                                                        %>>TypeScript</option>
                                                    <option value="Python" <%=lang==='Python' ? 'selected' : '' %>
                                                        >Python</option>
                                                    <option value="Ruby" <%=lang==='Ruby' ? 'selected' : '' %>>Ruby
                                                    </option>
                                                    <option value="PHP" <%=lang==='PHP' ? 'selected' : '' %>>PHP
                                                    </option>
                                                    <option value="Go" <%=lang==='Go' ? 'selected' : '' %>>Go</option>
                                                    <option value="Rust" <%=lang==='Rust' ? 'selected' : '' %>>Rust
                                                    </option>
                                                    <option value="Swift" <%=lang==='Swift' ? 'selected' : '' %>>Swift
                                                    </option>
                                                    <option value="Kotlin" <%=lang==='Kotlin' ? 'selected' : '' %>
                                                        >Kotlin</option>
                                                    <option value="Objective-C" <%=lang==='Objective-C' ? 'selected'
                                                        : '' %>>Objective-C</option>
                                                    <option value="Scala" <%=lang==='Scala' ? 'selected' : '' %>>Scala
                                                    </option>
                                                    <option value="Perl" <%=lang==='Perl' ? 'selected' : '' %>>Perl
                                                    </option>
                                                    <option value="R" <%=lang==='R' ? 'selected' : '' %>>R</option>
                                                    <option value="Dart" <%=lang==='Dart' ? 'selected' : '' %>>Dart
                                                    </option>
                                                    <option value="Haskell" <%=lang==='Haskell' ? 'selected' : '' %>
                                                        >Haskell</option>
                                                    <option value="Lua" <%=lang==='Lua' ? 'selected' : '' %>>Lua
                                                    </option>
                                                    <option value="Elixir" <%=lang==='Elixir' ? 'selected' : '' %>
                                                        >Elixir</option>
                                                    <option value="Clojure" <%=lang==='Clojure' ? 'selected' : '' %>
                                                        >Clojure</option>
                                                    <option value="Shell" <%=lang==='Shell' ? 'selected' : '' %>>Shell
                                                        (Bash)</option>
                                                    <option value="PowerShell" <%=lang==='PowerShell' ? 'selected' : ''
                                                        %>>PowerShell</option>
                                                    <option value="SQL" <%=lang==='SQL' ? 'selected' : '' %>>SQL
                                                    </option>
                                                    <option value="GraphQL" <%=lang==='GraphQL' ? 'selected' : '' %>
                                                        >GraphQL</option>
                                                    <option value="MATLAB" <%=lang==='MATLAB' ? 'selected' : '' %>
                                                        >MATLAB</option>
                                                    <option value="Assembly" <%=lang==='Assembly' ? 'selected' : '' %>
                                                        >Assembly</option>
                                                    <option value="Fortran" <%=lang==='Fortran' ? 'selected' : '' %>
                                                        >Fortran</option>
                                                    <option value="COBOL" <%=lang==='COBOL' ? 'selected' : '' %>>COBOL
                                                    </option>
                                                    <option value="Erlang" <%=lang==='Erlang' ? 'selected' : '' %>
                                                        >Erlang</option>
                                                    <option value="VB.NET" <%=lang==='VB.NET' ? 'selected' : '' %>
                                                        >VB.NET</option>
                                                </select>
                                                <span onclick="requestFull()" class="maximize" id="maximize"
                                                    style="cursor: pointer;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                        class="lucide lucide-maximize-icon lucide-maximize">
                                                        <path d="M8 3H5a2 2 0 0 0-2 2v3" />
                                                        <path d="M21 8V5a2 2 0 0 0-2-2h-3" />
                                                        <path d="M3 16v3a2 2 0 0 0 2 2h3" />
                                                        <path d="M16 21h3a2 2 0 0 0 2-2v-3" />
                                                    </svg>
                                                </span>
                                            </div>
                                    </div>

                                    <textarea id="code" style="width: 100% !important;"><%= card.content%></textarea>
                                </section>

                                <!-- 3. METADATA (SECONDARY) -->
                                <section class="snippet-meta" style="margin-top: 20px !important;">

                                    <div class="meta-field">
                                        <label>
                                            <span
                                                style="display: flex; justify-content: start;align-items: center;gap: 10px;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-folder-icon lucide-folder">
                                                    <path
                                                        d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
                                                </svg>
                                                Folder
                                            </span>
                                            <input type="text" id="folderName1" placeholder="Optional" value="<%= card.folderName%>"/>
                                        </label>
                                    </div>

                                    <div class="meta-field">
                                        <label>
                                            <span
                                                style="display: flex; justify-content: start;align-items: center;gap: 10px;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-tag-icon lucide-tag">
                                                    <path
                                                        d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z" />
                                                    <circle cx="7.5" cy="7.5" r=".5" fill="currentColor" />
                                                </svg>
                                                Tags
                                            </span>
                                            <input type="text" id="tags" placeholder="comma,separated,tags" value="<%= card.tags%>"/>
                                        </label>
                                    </div>
                                    <div class="meta-field">
                                        <label>
                                            <span
                                                style="display: flex; justify-content: start;align-items: center;gap: 10px;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-rss-icon lucide-rss">
                                                    <path d="M4 11a9 9 0 0 1 9 9" />
                                                    <path d="M4 4a16 16 0 0 1 16 16" />
                                                    <circle cx="5" cy="19" r="1" />
                                                </svg>
                                                Visibility
                                            </span>
                                            <select id="visibility">
                                                <option value="true" <%= card.visibility === "true" ? "selected" : "" %>>Public</option>
                                                <option value="false" <%= card.visibility === "false" ? "selected" : "" %>>Private</option>
                                            </select>
                                        </label>
                                    </div>

                                    <label class="meta-notes" style="display: block; width: 100% !important;">
                                        <span
                                            style="display: flex; justify-content: start;align-items: center;gap: 10px;"><svg
                                                xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="lucide lucide-notebook-icon lucide-notebook">
                                                <path d="M2 6h4" />
                                                <path d="M2 10h4" />
                                                <path d="M2 14h4" />
                                                <path d="M2 18h4" />
                                                <rect width="16" height="20" x="4" y="2" rx="2" />
                                                <path d="M16 2v20" />
                                            </svg> Description</span>
                                        <textarea id="des" placeholder="Optional notes…" rows="5"><%= card.description%></textarea>
                                    </label>


                                    <!-- Add Readme.md File Container  -->
                                    <div class="readme-container">
                                        <div class="readme-header">
                                            <span class="title"
                                                style="display: flex; justify-content: start;align-items: center; gap: 5px;font-weight: bolder;"><svg
                                                    xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-book-open-icon lucide-book-open">
                                                    <path d="M12 7v14" />
                                                    <path
                                                        d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z" />
                                                </svg> Add Readme.md File</span>
                                        </div>

                                        <!-- <hr style="margin-block:5px"> -->

                                        <div class="readme-body">
                                            <div class="meta-data"
                                                style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between;">
                                                <label for="readme_title" id="readme_title">
                                                    <span
                                                        style="display: flex; align-items: center; gap: 5px; font-weight: 400 !important; font-size: small;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            class="lucide lucide-notebook-pen-icon lucide-notebook-pen">
                                                            <path
                                                                d="M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4" />
                                                            <path d="M2 6h4" />
                                                            <path d="M2 10h4" />
                                                            <path d="M2 14h4" />
                                                            <path d="M2 18h4" />
                                                            <path
                                                                d="M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z" />
                                                        </svg>Enter a title</span>
                                                    <input type="text" name="readme_title" id="readme_title1"
                                                        placeholder="Title" value="<%= card.readmefile.title%>">
                                                </label>
                                                <label for="readme_desciption" id="readme_desciption" role="text">
                                                    <span
                                                        style="display: flex; align-items: center; gap: 5px; font-weight: 400 !important; font-size: small;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            class="lucide lucide-notebook-pen-icon lucide-notebook-pen">
                                                            <path
                                                                d="M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4" />
                                                            <path d="M2 6h4" />
                                                            <path d="M2 10h4" />
                                                            <path d="M2 14h4" />
                                                            <path d="M2 18h4" />
                                                            <path
                                                                d="M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z" />
                                                        </svg>Enter a description</span>
                                                    <textarea type="text" name="readme_desciption"
                                                        id="readme_desciption1" placeholder="Description"><%= card.readmefile.description%></textarea>
                                                </label>
                                            </div>
                                            <textarea id="asd"><%= card.readmefile.content%></textarea>
                                        </div>
                                    </div>
                                    <!--End of Add Readme.md File Container  -->

                                    <span role="note"
                                        style="font-size: x-small; color: gray; line-height: 1.5; width: 80%;">
                                        Note<sup style="color: red;">*</sup>: Upon saving, the code snippet will be
                                        recorded under the
                                        active folder context.
                                        Users are advised to confirm the selected folder before proceeding, as this
                                        determines how the
                                        snippet will be
                                        categorized and retrieved later.
                                    </span>


                                </section>
                                <%- include("partials/fab.ejs")%>
                            </div>

                            <div class="loading" style="display: none">
                                <span style="
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                color: black;
                background: none;
              ">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="lucide lucide-loader-circle-icon lucide-loader-circle">
                                        <path d="M21 12a9 9 0 1 1-6.219-8.56" />
                                    </svg>
                                    Sending Data...</span>
                            </div>

                        </main>



                        <div class="notification-bar">
                            <h3>Notifications</h3>
                            <ul class="notification-lists">
                            </ul>
                        </div>

                </div>
        </div>

 <script>
  
    let editor;
    let easyMDE;

 
    document.addEventListener("DOMContentLoaded", async () => {
        easyMDE = new EasyMDE({
            element: document.getElementById("asd"),
            toolbar: [
                "bold", "italic", "heading", "|",
                "quote", "unordered-list", "ordered-list", "|",
                "link", "image", "table", "|",
                "preview",
            ]
        });

        initCodeMirror();
        await getEditorSettings();
    });

    /* ─────────────────────────────
       CODEMIRROR INIT
    ───────────────────────────── */
    function initCodeMirror() {
        const modeMap = {
            JavaScript: "javascript",
            C: "text/x-csrc",
            "C++": "text/x-c++src",
            "C#": "text/x-csharp",
            Java: "text/x-java",
            TypeScript: "text/typescript",
            Python: "python",
            Ruby: "ruby",
            PHP: "php",
            Go: "go",
            Rust: "rust",
            Swift: "swift",
            Kotlin: "text/x-kotlin",
            "Objective-C": "text/x-objectivec",
            Scala: "text/x-scala",
            Perl: "perl",
            R: "r",
            Dart: "dart",
            Haskell: "haskell",
            Lua: "lua",
            Elixir: "elixir",
            Clojure: "clojure",
            Shell: "shell",
            PowerShell: "powershell",
            SQL: "sql",
            GraphQL: "graphql",
            MATLAB: "octave",
            Assembly: "gas",
            Fortran: "fortran",
            COBOL: "cobol",
            Erlang: "erlang",
            "VB.NET": "vb",
            HTML: "htmlmixed",
            CSS: "css",
        };

        const languageSelect = document.getElementById("category");

        editor = CodeMirror.fromTextArea(
            document.getElementById("code"),
            {
                lineNumbers: true,
                lineWrapping: true,
                mode: modeMap[languageSelect?.value] || "javascript",
                theme: "eclipse",
                extraKeys: {
                    "Ctrl-Space": "autocomplete",
                    "Ctrl-/": "toggleComment",
                    "Tab": cm => cm.replaceSelection("  "),
                }
            }
        );

        /* Proper height */
        editor.setSize("100%", "500px");

        /* Language change */
        languageSelect?.addEventListener("change", function () {
            editor.setOption("mode", modeMap[this.value] || "javascript");
        });
    }

    /* ─────────────────────────────
       SUBMIT DATA (GLOBAL)
    ───────────────────────────── */
    async function submitData() {
        try {
            const payload = {
                title: document.getElementById("title1")?.value || "",
                description: document.getElementById("des")?.value || "",
                category: document.getElementById("category")?.value || "",
                content: editor.getValue() || "",
                folderName: document.getElementById("folderName1")?.value || "",
                visibility: document.getElementById("visibility")?.value || "",
                tags: (document.getElementById("tags")?.value || "")
                    .split(",")
                    .map(t => t.trim())
                    .filter(Boolean),
                readmefile: {
                    title: document.getElementById("readme_title1")?.value || "",
                    description: document.getElementById("readme_desciption1")?.value || "",
                    content: easyMDE.value() || ""
                }
            };

            const res = await fetch("/card/<%= id %>", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "include",
                body: JSON.stringify(payload),
            });

            const data = await res.json();

            if (!res.ok) throw new Error("Save failed");

            new Toastmaster({
                title: "Success",
                message: "Snippet saved successfully",
                delay: 3000,
                type: "success"
            }).showNotification();

        } catch (err) {
            console.error(err);
            new Toastmaster({
                title: "Error",
                message: "Snippet not saved",
                delay: 3000,
                type: "error"
            }).showNotification();
        }
    }

    /* ─────────────────────────────
       SETTINGS LOAD
    ───────────────────────────── */
    async function getEditorSettings() {
        try {
            const res = await fetch("/settings/list", {
                method: "GET",
                credentials: "include",
                headers: { "Content-Type": "application/json" }
            });

            if (!res.ok) return;

            const data = await res.json();

            editor.setOption("tabSize", data.tabSize || 2);
            editor.setOption("lineWrapping", data.wordWrap !== "off");
            editor.setOption("lineNumbers", data.lineNumbers === "on");
            editor.setOption("theme", data.syntaxStyle || "eclipse");

        } catch (err) {
            console.error("Editor settings failed:", err);
        }
    }

    /* ─────────────────────────────
       FULLSCREEN HANDLING
    ───────────────────────────── */
    function requestFull() {
        const wrapper = document.querySelector(".snippet-editor");
        if (!wrapper) return;

        if (document.fullscreenElement) {
            document.exitFullscreen();
        } else {
            wrapper.requestFullscreen();
        }
    }

    window.addEventListener("fullscreenchange", () => {
        const cm = document.querySelector(".CodeMirror");
        if (!cm) return;
        cm.classList.toggle("active", !!document.fullscreenElement);
    });
</script>

        <script src="\scripts\shortcut.js"></script>
        <script src="/scripts/home.js"></script>
        <script src="\scripts\index.js"></script>
        <script src="\scripts\Notification.js"></script>
        <script src="\scripts\ad_search.js"></script>
        <script src="\scripts\header.js"></script>
        <script src="\scripts\searchFunction.js"></script>
        <script src="\scripts\saveDraft.js"></script>
        <!-- <script src="\scripts\context_menu.js"></script> -->

        <script>

        </script>

</body>

</html>