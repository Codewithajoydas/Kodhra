<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        <%= card.title %> | Code Snippet Manager
    </title>
    <link rel="stylesheet" href="/style/css/partials/Header.css">
    <link rel="stylesheet" href="/style/css/ad_search.css">
    <link rel="stylesheet" href="/style/css/Notification.css">
    <link rel="stylesheet" href="/style/css/index.css">
    <link rel="stylesheet" href="/style/css/chip.css">
    <link rel="stylesheet" href="/style/css/card.css">
    <link rel="stylesheet" href="/style/css/folder.css">
    <link rel="stylesheet" href="/style/css/createSnippet.css">
    <link rel="stylesheet" href="/style/css/toast.css">
    <script src="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@2.3.5/dist/toaster.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@codewithajoydas/toastmaster@2.3.5/dist/toaster.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/assets/logo.png" type="image/png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/theme/eclipse.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/theme/ayu-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <!-- CodeMirror Core -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>

    <!-- Languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <!-- C, C++, C#, Java, Scala, Kotlin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/ruby/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/go/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/rust/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/swift/swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/shell/shell.min.js"></script>
    <!-- Bash -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/powershell/powershell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <!-- Needed for HTML, XML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/perl/perl.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/r/r.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/haskell/haskell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/erlang/erlang.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/dart/dart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clojure/clojure.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/matlab/matlab.min.js"></script>
    <!-- HTML mode -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <!-- dependency -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <!-- dependency -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <!-- dependency -->

    <!-- CSS mode -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://unpkg.com/colorthief/dist/color-thief.umd.js"></script>

    <style>
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            position: fixed;
            background: white;
            z-index: 100000;
            top: 0;
            font-size: clamp(30px, 3vw, 40px);

            font-weight: bolder;
        }

        .spain {
            width: 0.5em;
            height: 0.5em;
            background: #000000;
            border-radius: 50%;
            margin: 5px;
            animation: spin 0.6s ease-in-out infinite;
        }

        .spain:nth-child(1) {
            animation-delay: 0.1s;
        }

        .spain:nth-child(2) {
            animation-delay: 0.2s;
        }

        .spain:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes spin {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .CodeMirror.active {
            height: 100vh;
        }
    </style>
    <script src="https://unpkg.com/@barba/core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@barba/core"></script>
    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
</head>

<body data-theme="light">
    <div class="loader">
        <div style="display: flex; justify-content: center; align-items: end">
            Loading
            <div class="spain"></div>
            <div class="spain"></div>
            <div class="spain"></div>
        </div>
    </div>
    <div class="content">
        <%- include("partials/header")%>
            <div class="container">
                <%- include("partials/sidebar", {navigation: 'card-create' })%>
                    <main style="width: 100%;height: calc(100vh - 70px);">

                        <div class="div1">
                            <div class="title">
                                <label for="title">What is the title?</label>
                                <input type="text" id="title1" name="title" placeholder="Enter your title"
                                    value="<%= card.title %>" />
                            </div>
                            <div class="des">
                                <label for="des"> And what is the Description? </label>
                                <textarea type="text" id="des" name="description" rows="8"
                                    placeholder="Enter your Description.."><%= card.description %></textarea>
                            </div>
                            <div class="lan">
                                <label for="lan"> Last what is language you prefer? </label>
                                <select name="language" id="category">
                                    <% const
                                        langs=["JavaScript","CSS","HTML","C","C++","C#","Java","TypeScript","Python","Ruby","PHP","Go","Rust","Swift","Kotlin","Objective-C","Scala","Perl","R","Dart","Haskell","Lua","Elixir","Clojure","Shell","PowerShell","SQL","GraphQL","MATLAB","Assembly","Fortran","COBOL","Erlang","VB.NET"];
                                        langs.forEach(lang=> {
                                        %>
                                        <option value="<%= lang %>" <%=card.category===lang ? 'selected' : '' %>><%=
                                                lang %>
                                        </option>
                                        <% }) %>

                                </select>
                            </div>
                        </div>
                        <div class="div2">
                            <div class="code">
                                <label for="code"
                                    style="display: flex; justify-content: space-between;align-items: center;margin-block: 10px;margin-bottom: 5px;">Finally
                                    Write Your Code Below <span onclick="requestFull(this)"><svg
                                            xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            class="lucide lucide-fullscreen-icon lucide-fullscreen">
                                            <path d="M3 7V5a2 2 0 0 1 2-2h2" />
                                            <path d="M17 3h2a2 2 0 0 1 2 2v2" />
                                            <path d="M21 17v2a2 2 0 0 1-2 2h-2" />
                                            <path d="M7 21H5a2 2 0 0 1-2-2v-2" />
                                            <rect width="10" height="8" x="7" y="8" rx="1" />
                                        </svg></span></label>
                                <textarea name="code" id="code" placeholder="Code"><%= card.content %></textarea>

                            </div>
                            <div class="tags" style="margin-top: 10px">
                                <label for="tags">Tags (Comma Separated)</label>
                                <input type="text" name="tags" placeholder="Enter Tags..." id="tags"
                                    value="<%= card.tags.map(e => e).join(', ') %>" />
                            </div>
                            <button type="submit" onclick="submitData()">
                                Submit the snippet
                            </button>
                        </div>

                    </main>
                    <div class="notification-bar">
                        <h3>Notifications</h3>
                        <ul class="notification-lists">
                        </ul>
                    </div>

            </div>
    </div>



    <script>
        let editor;
        window.onload = () => {
            document.querySelector(".loader").style.display = "none";
            const modeMap = {
                JavaScript: "javascript",
                C: "text/x-csrc",
                "C++": "text/x-c++src",
                "C#": "text/x-csharp",
                Java: "text/x-java",
                TypeScript: "text/typescript",
                Python: "python",
                Ruby: "ruby",
                PHP: "php",
                Go: "go",
                Rust: "rust",
                Swift: "swift",
                Kotlin: "text/x-kotlin",
                "Objective-C": "text/x-objectivec",
                Scala: "text/x-scala",
                Perl: "perl",
                R: "r",
                Dart: "dart",
                Haskell: "haskell",
                Lua: "lua",
                Elixir: "elixir",
                Clojure: "clojure",
                Shell: "shell",
                PowerShell: "powershell",
                SQL: "sql",
                GraphQL: "graphql",
                MATLAB: "octave",
                Assembly: "gas",
                Fortran: "fortran",
                COBOL: "cobol",
                Erlang: "erlang",
                "VB.NET": "vb",
                HTML: "htmlmixed",
                CSS: "css",
            };

            const lan = document.getElementById("category");

            const themeRadio = document.querySelector("input[name='theme']:checked");
            const currentTheme =
                themeRadio && themeRadio.value === "light" ? "eclipse" : "ayu-dark";

            editor = CodeMirror.fromTextArea(document.getElementById("code"), {
                lineNumbers: true,
                mode: modeMap[lan?.value] || "javascript",
                lineWrapping: true,
                theme: currentTheme,
            });

            const titleEl = document.getElementById("title1");
            const desEl = document.getElementById("des");
            const catEl = document.getElementById("category");
            const tagEl = document.getElementById("tags");
            const folderEl = document.getElementById("folderName1");

            if (lan) {
                lan.addEventListener("change", function () {
                    const newMode = modeMap[this.value] || "javascript";
                    editor.setOption("mode", newMode);
                });
            }

            document.querySelectorAll("input[name='theme']").forEach((inp) => {
                inp.addEventListener("change", () => {
                    const newTheme = inp.value === "light" ? "eclipse" : "ayu-dark";
                    editor.setOption("theme", newTheme);
                    localStorage.setItem("theme", inp.value);
                });
            });

            window.submitData = async function () {
                const title = titleEl?.value || "";
                const description = desEl?.value || "";
                const category = catEl?.value || "";
                const content = editor.getValue() || "";
                const folderName = folderEl?.value || "";
                const tags = (tagEl?.value || "")
                    .split(",")
                    .map((tag) => tag.trim())
                    .filter(Boolean);


                try {
                    new Toastmaster({
                        title: "Creating Snippet",
                        message: "Please wait...",
                        type: "info",
                        delay: 5000,
                    }).showNotification();
                    const startTime = performance.now();

                    const res = await fetch(`/card/<%card._id%>`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        credentials: "include",
                        body: JSON.stringify({ title, description, category, content, tags }),
                    });

                    const data = await res.json();
                    console.log("Response:", data);

                    const duration = ((performance.now() - startTime) / 1000).toFixed(2);

                    if (res.ok) {
                        new Toastmaster({
                            title: "Success",
                            message: `Snippet Created Successfully in ${duration} seconds`,
                            type: "success",
                            delay: 5000,
                        }).showNotification();
                        titleEl.value = "";
                        desEl.value = "";
                        catEl.value = "";
                        editor.setValue("");
                        tagEl.value = "";
                        folderEl.value = "";
                    } else {
                        new Toastmaster({
                            title: "Error",
                            message: "Failed to create snippet",
                            type: "error",
                            delay: 5000,
                        }).showNotification();
                    }
                } catch (err) {
                    console.error("Error submitting data:", err);
                    new Toastmaster({
                        title: "Error",
                        message: "Failed to create snippet",
                        type: "error",
                        delay: 5000
                    }).showNotification()
                }
            };
        };
    </script>




    <script>
        // if ("serviceWorker" in navigator) {
        //     navigator.serviceWorker
        //       .register("/service-worker.js")
        //       .then((e) => console.log(`Service Worker registered ${e.installing}`))
        //       .catch((err) => console.error("SW registration failed:", err));
        //   }
    </script>

    <script>
        const labelOfCode = document.querySelector("label[for='code']");
        function requestFull() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.querySelector(".CodeMirror").classList.toggle("active");
                document.querySelector(".code").requestFullscreen();
            }
        }
        window.addEventListener("fullscreenchange", () => {
            if (document.fullscreenElement) {
                document.querySelector(".CodeMirror").classList.add("active");
            } else {
                document.querySelector(".CodeMirror").classList.remove("active")
            }
        });
    </script>


    <script>

    </script>

    <script src="/scripts/home.js"></script>
    <script src="\scripts\index.js"></script>
    <script src="\scripts\search.js"></script>
    <script src="\scripts\Notification.js"></script>
    <script src="\scripts\ad_search.js"></script>
    <script src="\scripts\header.js"></script>
    <script src="\scripts\searchFunction.js"></script>
    <script src="\scripts\saveDraft.js"></script>
  <script src="\scripts\shortcut.js"></script>

</body>

</html>