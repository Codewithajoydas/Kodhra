<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | Code Snippet Manager</title>
  <link rel="stylesheet" href="/style/css/partials/Header.css">
  <link rel="stylesheet" href="/style/css/ad_search.css">
  <link rel="stylesheet" href="/style/css/Notification.css">
  <link rel="stylesheet" href="/style/css/chip.css">
  <link rel="stylesheet" href="/style/css/card.css">
  <link rel="stylesheet" href="/style/css/toast.css">
  <link rel="stylesheet" href="/style/css/index.css">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="/assets/logo.png" type="image/png" />
  <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>
  <link rel="preload" href="/gEzG0w1WVY.lottie" as="fetch" crossorigin="anonymous" />
  <link rel="manifest" href="manifest.json" />
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <style>
    .loader {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100%;
      position: fixed;
      z-index: 100000;
      top: 0;
      font-size: clamp(30px, 3vw, 40px);

      font-weight: bolder;
    }

    .spain {
      width: 0.5em;
      height: 0.5em;
      background: #000000;
      border-radius: 50%;
      margin: 5px;
      animation: spin 0.6s ease-in-out infinite;
    }

    .spain:nth-child(1) {
      animation-delay: 0.1s;
    }

    .spain:nth-child(2) {
      animation-delay: 0.2s;
    }

    .spain:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes spin {
      0% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }

      100% {
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <div class="loader">
    <dotlottie-wc src="gEzG0w1WVY.lottie" style="width: 400px; height: 400px" speed="1" autoplay loop></dotlottie-wc>
  </div>
  <div class="content">
    <%- include("partials/header", {appVersion}) %>
      <div class="container">
        <%- include("partials/sidebar", { navigation: 'home' }) %>
          <main>
            <div class="page_title">
              Overview Section
            </div>
            <div class="greeting">
              <img src="https://cdn3d.iconscout.com/3d/premium/thumb/motivation-3d-icon-png-download-11696859.png"
                alt="">
              <span>
                <h1>Hello, <span id="username" style="text-transform: capitalize;">
                    <%= author %>
                  </span></h1>
                <span class="motivation"></span>
              </span>
            </div>
            <div class="count">
              <div class="totalSnippet" onclick="window.location.assign('/card')">
                <div class="img">
                  <img src="https://cdn3d.iconscout.com/3d/premium/thumb/code-snippet-3d-icon-png-download-9483695.png"
                    alt="" width="60px">
                </div>
                <div>
                  <span id="totalSnippet">0</span>
                  <span>Total Snippets</span>
                </div>
              </div>
              <div class="totalFolder" onclick="window.location.assign('/folder')">
                <div class="img">
                  <img src="https://cdn3d.iconscout.com/3d/premium/thumb/folder-3d-icon-png-download-5727518.png"
                    alt="">
                </div>
                <div>
                  <span id="totalFolder">0</span>
                  <span>Total Folders</span>
                </div>
              </div>
              <div class="totalTag" onclick="window.location.assign('/tags')">
                <div class="img">
                  <img
                    src="https://static.vecteezy.com/system/resources/previews/010/988/613/non_2x/3d-isolated-price-tag-icon-free-png.png"
                    alt="">
                </div>
                <div>
                  <span id="totalTag">0</span>
                  <span>Total Tags</span>
                </div>
              </div>
              <div class="totalTag">
                <div class="img">
                  <img src="https://cdn3d.iconscout.com/3d/premium/thumb/document-3d-icon-png-download-8779273.png"
                    alt="">
                </div>
                <div>
                  <span id="totalTag">0</span>
                  <span>Total Drafts</span>
                </div>
              </div>
            </div>
            <div class="reports">
              <div class="dailywisechart">
                <div style="display: flex;justify-content: space-between;align-items: center;">
                  <span style="font-weight: bolder; padding-bottom: 10px;">Daily Wise Report</span>
                  <input type="month" style="border: 1px solid var(--accent);padding: 10px;border-radius: 10px;"
                    id="datePicker">
                </div>
                <canvas id="dailyChart"></canvas>
              </div>
              <canvas id="languageChart"></canvas>
            </div>

            <div class="page_title">
              Recent Snippets
            </div>
            <div id="cards" style="overflow-y: scroll !important;">
              <%- include("partials/cards") %>
            </div>
          </main>
      </div>
  </div>

  <div id="context_menu" style="
        position: absolute;
        top: 0;
        left: 0;
        display: none;
        z-index: 1000000;
        width: 200px;
      ">
    <ul id="context_menu_list"></ul>
  </div>


  <div class="networkInfo" style="display: none;">
    <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-info-icon lucide-info">
        <circle cx="12" cy="12" r="10" />
        <path d="M12 16v-4" />
        <path d="M12 8h.01" />
      </svg></span>

    <span id="networkInfo"></span>
  </div>



  <script>
    const datePicker = document.getElementById("datePicker");
    const motivation = document.querySelector(".motivation");
    window.onload = async () => {
      const res = await fetch("/motivational.json");
      const data = await res.json();
      motivation.textContent = data[Math.floor(Math.random() * data.length)];
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      datePicker.value = `${year}-${month}`;
      document.querySelector(".loader").style.display = "none";
    };
    datePicker.addEventListener("input", () => {
      console.log(datePicker.value)
    })
  </script>

  <script>
    let dailyCounts = [];
    let dailyChartInstance = null;

    window.onload = async () => {
      const res = await fetch("/motivational.json");
      const data = await res.json();
      motivation.textContent = data[Math.floor(Math.random() * data.length)];

      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      datePicker.value = `${year}-${month}`;

      document.querySelector(".loader").style.display = "none";

      getCounts(year, Number(month));
    };

    async function getCounts(selectedYear, selectedMonth) {
      const res = await fetch("/report");
      const data = await res.json();

      document.getElementById("totalSnippet").textContent = data.totalCards;
      document.getElementById("totalFolder").textContent = data.totalFolders;
      document.getElementById("totalTag").textContent = data.totalTags;

      dailyCounts = data.dailyCounts;
      const languageReport = data.languageReport;

      const langLabels = languageReport.map(l => l._id);
      const langData = languageReport.map(l => l.count);
      const colors = languageReport.map(() => getRandomColor());

      const langCtx = document.getElementById("languageChart").getContext("2d");
      new Chart(langCtx, {
        type: "polarArea",
        data: {
          labels: langLabels,
          datasets: [{
            label: "Snippets per Language",
            data: langData,
            backgroundColor: colors,
            borderColor: "rgba(255, 255, 255, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: "Snippets per Language" }
          }
        }
      });

      renderDailyChart(selectedYear, selectedMonth);
    }

    function getRandomColor(alpha = 0.6) {
      const r = Math.floor(Math.random() * 255);
      const g = Math.floor(Math.random() * 255);
      const b = Math.floor(Math.random() * 255);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function renderDailyChart(selectedYear, selectedMonth) {
      const filtered = dailyCounts.filter(d =>
        d._id.year === selectedYear && d._id.month === selectedMonth
      );

      const dailyCountsLabels = filtered.map(d =>
        `${String(d._id.day).padStart(2, "0")}`
      );

      const dailyCountsData = filtered.map(d => d.count);

      const dailyCtx = document.getElementById("dailyChart").getContext("2d");

      if (dailyChartInstance) dailyChartInstance.destroy();

      dailyChartInstance = new Chart(dailyCtx, {
        type: "line",
        data: {
          labels: dailyCountsLabels,
          datasets: [{
            label: "Snippets per Day",
            data: dailyCountsData,
            backgroundColor: "#7274E0",
            borderColor: "rgba(255, 255, 255, 0.5)",
            borderWidth: 2,
            fill: true,
            tension: 0.3,
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: "Snippets per Day" }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    datePicker.addEventListener("change", () => {
      const [year, month] = datePicker.value.split("-").map(Number);
      renderDailyChart(year, month);
    });
  </script>




  <script src="/scripts/home.js"></script>
  <script src="\scripts\shortcut.js"></script>
  <script src="\scripts\index.js"></script>
  <script src="\scripts\context_menu.js"></script>
  <script src="\scripts\Notification.js"></script>
  <script src="\scripts\ad_search.js"></script>
  <script src="\scripts\isonline.js"></script>
  <script src="\scripts\header.js"></script>
  <script src="\scripts\searchFunction.js"></script>

</body>

</html>